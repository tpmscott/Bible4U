<!doctype html>
<html>
 <head>
  <script src="dexie.js"></script>
  <script>
   //
   // Declare Database
   //
   //var db2 = new Dexie("FriendDatabase");
   //db.version(1).stores({
   //  friends: "++id,name,age"
   //});

     var db = new Dexie('booksDb');
     db.version(0.1).stores({
         books: 'name'
     });

     var dbT = new Dexie('books_TestDb');
     dbT.version(1).stores({
         books: 'name,book_no,chap_no'
     });



   //
   // Manipulate and Query Database
   //
   //db2.friends.add({name: "世光", age: 50}).then(function() {
   //    return db2.friends.where("age").below(60).toArray();
   //}).then(function (youngFriends) {
   //    alert ("My young friends: " + JSON.stringify(youngFriends));
   //}).catch(function (e) {
   //    alert ("Error: " + (e.stack || e));
   //});



var data = [
   ['Foo', 'programmer'],
   ['Bar', 'bus driver'],
   ['Moo', 'Reindeer Hunter']
];
 
 
function download_csv_0() {
    var csv = 'Name,Title\n';
    data.forEach(function(row) {
            csv += row.join(',');
            csv += "\n";
    });
 
    console.log(csv);
    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
    hiddenElement.target = '_blank';
    hiddenElement.download = 'people.csv';
    hiddenElement.click();
}


async function download_csv_1() {

    var Verse = await db.books.toArray();

    var csv = 'name,color_no,book_no,chap_no,vers_no\n';

    for (i = 0; i < Verse.length; i++) {

       csv += Verse[i].name + ',' + Verse[i].color_no + ',' + Verse[i].book_no + ',' + Verse[i].chap_no + ',' + Verse[i].vers_no + '\n';

    }

    //Verse.forEach(function(row) {
    //        csv += row.join(',');
    //        csv += "\n";
    //});
 
    console.log(csv);
    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
    hiddenElement.target = '_blank';
    hiddenElement.download = 'books_Db.csv';
    hiddenElement.click();
} // End of function download_csv_1()


async function download_csv() {

    var Verse = await dbT.books.toArray();

    var csv = 'name,color_no,book_no,chap_no,vers_no\n';

    for (i = 0; i < Verse.length; i++) {

       csv += Verse[i].name + ',' + Verse[i].color_no + ',' + Verse[i].book_no + ',' + Verse[i].chap_no + ',' + Verse[i].vers_no + '\n';

    }

    //Verse.forEach(function(row) {
    //        csv += row.join(',');
    //        csv += "\n";
    //});
 
    console.log(csv);
    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
    hiddenElement.target = '_blank';
    hiddenElement.download = 'books_TestDb.csv';
    hiddenElement.click();
} // End of function download_csv()


async function addBook_to_books_TestDb() {
  let name = prompt("Book name?");
  let color_no = +prompt("Book color?");
  let book_no = +prompt("Book No?");
  let chap_no = +prompt("Chap No?");
  let vers_no = +prompt("Vers No?");

  //let tx = db.transaction('books', 'readwrite');

  try {
    //await tx.objectStore('books').add({name,color_no, book_no, chap_no, vers_no});

    dbT.books.add({name,color_no, book_no, chap_no, vers_no});

    //dbT.books.add({name: "Ingemar Bergman", isCloseFriend: 0});


    //await list();
  } catch(err) {
    if (err.name == 'ConstraintError') {
      alert("Such book exists already");
      //await addBook();
    } else {
      throw err;
    }
  }
}


async function list_all_TestDb() {


  let Verse = await dbT.books.toArray();

  //db.table.toArray()

  //let Verse = await db.books.getAll();


  if (Verse) {

     if (Verse.length) {
       listElem.innerHTML = Verse.map(book => `<li>
           name: ${book.name}, color: ${book.color_no}, book_no: ${book.book_no}, chap_no: ${book.chap_no}, vers_no: ${book.vers_no}
         </li>`).join('');
     } else {
       listElem.innerHTML = '<li>No Data</li>'
     }

  }
  else {

     listElem.innerHTML = 'No Data';

  }


}  // End of function list_all_TestDb()


async function list_idx2_TestDb() {


  //let Verse = await dbT.books.where('book_no').equals(39).toArray();  

  let Verse = await dbT.books.where('chap_no').equals(1).toArray();  // vers_no


  if (Verse) {

     if (Verse.length) {
       listElem.innerHTML = Verse.map(book => `<li>
           name: ${book.name}, color: ${book.color_no}, book_no: ${book.book_no}, chap_no: ${book.chap_no}, vers_no: ${book.vers_no}
         </li>`).join('');
     } else {
       listElem.innerHTML = '<li>No Data</li>'
     }

  }
  else {

     listElem.innerHTML = 'No Data';

  }


}  // End of function list_idx2_TestDb()


async function list_idx_TestDb() {


  let Verse = await dbT.books.where('book_no').equals(39).toArray();  

  //let Verse = await dbT.books.where('chap_no').equals(1).toArray();  // vers_no


  if (Verse) {

     if (Verse.length) {
       listElem.innerHTML = Verse.map(book => `<li>
           name: ${book.name}, color: ${book.color_no}, book_no: ${book.book_no}, chap_no: ${book.chap_no}, vers_no: ${book.vers_no}
         </li>`).join('');
     } else {
       listElem.innerHTML = '<li>No Data</li>'
     }

  }
  else {

     listElem.innerHTML = 'No Data';

  }


}  // End of function list_idx_TestDb()



async function list_all() {


  let Verse = await db.books.toArray();

  //db.table.toArray()

  //let Verse = await db.books.getAll();


  if (Verse) {

     if (Verse.length) {
       listElem.innerHTML = Verse.map(book => `<li>
           name: ${book.name}, color: ${book.color_no}, book_no: ${book.book_no}, chap_no: ${book.chap_no}, vers_no: ${book.vers_no}
         </li>`).join('');
     } else {
       listElem.innerHTML = '<li>No Data</li>'
     }

  }
  else {

     listElem.innerHTML = 'No Data';

  }


}  // End of function list_all()


async function list_idx() {


  let Verse = await db.books.where('book_no').equals('65').toArray();


  if (Verse) {

     if (Verse.length) {
       listElem.innerHTML = Verse.map(book => `<li>
           name: ${book.name}, color: ${book.color_no}, book_no: ${book.book_no}, chap_no: ${book.chap_no}, vers_no: ${book.vers_no}
         </li>`).join('');
     } else {
       listElem.innerHTML = '<li>No Data</li>'
     }

  }
  else {

     listElem.innerHTML = 'No Data';

  }


}  // End of function list_idx()


async function list_3() {


  let Verse = await db.books.where('name').startsWithIgnoreCase('40_7').toArray();


  if (Verse) {

     if (Verse.length) {
       listElem.innerHTML = Verse.map(book => `<li>
           name: ${book.name}, color: ${book.color_no}, book_no: ${book.book_no}, chap_no: ${book.chap_no}, vers_no: ${book.vers_no}
         </li>`).join('');
     } else {
       listElem.innerHTML = '<li>No Data</li>'
     }

  }
  else {

     listElem.innerHTML = 'No Data';

  }


}


async function list_2() {


  let Verse = await db.books.where('name').startsWithIgnoreCase('39_').toArray();


  if (Verse) {

     if (Verse.length) {
       listElem.innerHTML = Verse.map(book => `<li>
           name: ${book.name}, color: ${book.color_no}, book_no: ${book.book_no}, chap_no: ${book.chap_no}, vers_no: ${book.vers_no}
         </li>`).join('');
     } else {
       listElem.innerHTML = '<li>No Data</li>'
     }

  }
  else {

     listElem.innerHTML = 'No Data';

  }


}


async function list_1() {


  let Verse = await db.books.get('1_1_14');


  if (Verse) {

     var text = 'Name: ' + Verse.name + ',  Color: ' + Verse.color_no;

     listElem.innerHTML = text;

  }
  else {

     listElem.innerHTML = 'No Data';

  }

}  // End of function list_1()


async function delete_1() {  // Delete 1_2_18


  //let Verse = await db.books.where('name').startsWithIgnoreCase('39_').toArray();

  db.books.delete('1_2_18');


  //if (Verse) {

  //   if (Verse.length) {
  //     listElem.innerHTML = Verse.map(book => `<li>
  //         name: ${book.name}, color: ${book.color_no}, book_no: ${book.book_no}, chap_no: ${book.chap_no}, vers_no: ${book.vers_no}
  //       </li>`).join('');
  //   } else {
  //     listElem.innerHTML = '<li>No Data</li>'
  //   }

  //}
  //else {

  //   listElem.innerHTML = 'No Data';

  //}


}  // End of function delete_1()


  </script>
 </head>

<button onclick="addBook_to_books_TestDb()">Add to books_TestDb</button>  
<button onclick="list_idx_TestDb()">List book no 39 by Index </button>
<button onclick="list_idx2_TestDb()">List chop no 1 by Index </button>
<button onclick="list_all_TestDb()">List All books_TestDb </button> 
<button onclick="download_csv()">Download books_TestDb </button><br><br>  
<button onclick="list_1()">List 1_1_14</button> 
<button onclick="list_2()">List 39_ </button>
<button onclick="list_3()">List 40_7_ </button>  
<button onclick="list_idx()">List 65 by Index </button>
<button onclick="delete_1()">Delete 1_2_18 </button>  
<button onclick="list_all()">List All</button>
<button onclick="download_csv_1()">Download books_Db </button><br><br>  


<p>Books list:</p>

<ul id="listElem"></ul>


</html>